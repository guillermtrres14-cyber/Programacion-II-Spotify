<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Spotify ML Dashboard 2024</title>

    <!-- Fuentes y estilos -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
<div class="page">

    <!-- NAVBAR -->
    <header class="navbar">
        <div class="logo">
            <div class="logo-icon">ML</div>
            <div>
                <div class="logo-text-main">Spotify ML Dashboard</div>
                <div class="logo-text-sub">Proyecto de Machine Learning – 2024</div>
            </div>
        </div>

        <nav class="nav-links">
            <a href="{{ url_for('index') }}">Inicio</a>
            <a href="{{ url_for('vista_dataset') }}">Dataset</a>
            <a href="#" class="nav-pill">Demo local</a>
        </nav>
    </header>

    <!-- HERO -->
    <section class="hero">
        <div class="hero-text">

            <div class="eyebrow">
                <span></span>
                <div>Análisis global de streaming en Spotify</div>
            </div>

            <h1 class="hero-title">
                Predice, agrupa y analiza <span class="hero-highlight">streams</span>
                con modelos de Machine Learning.
            </h1>

            <p class="hero-subtitle">
                Esta plataforma permite ejecutar modelos de
                <strong>Regresión Lineal</strong>,
                <strong>Árbol de Decisión</strong>,
                <strong>K-means</strong>
                y <strong>Análisis de Sentimiento</strong>,
                utilizando datos reales del dataset Spotify 2024.
            </p>

            <!-- BOTONES PRINCIPALES -->
            <div class="hero-actions">
                <a href="{{ url_for('vista_regresion') }}" class="btn btn-primary">
                    Ejecutar Regresión de Streams
                </a>
                <a href="{{ url_for('vista_dataset') }}" class="btn btn-ghost">
                    Ver muestra del Dataset
                </a>
                <a href="{{ url_for('vista_sentimiento') }}" class="btn btn-primary">
                    Análisis de Sentimiento
                </a>
            </div>

            <!-- METRICS INFO -->
            <div class="hero-meta">
                {% if selected_model %}
                    Modelo seleccionado:
                    <strong>{{ selected_model }}</strong>
                {% else %}
                    Selecciona un modelo para ver sus métricas.
                {% endif %}
            </div>
        </div>

        <!-- PANEL DERECHA DE MÉTRICAS -->
        <aside class="hero-panel">
            <div class="panel-header">
                <div>
                    <div class="panel-title">
                        {% if selected_model %}
                            Resultados – {{ selected_model }}
                        {% else %}
                            Resultados del modelo
                        {% endif %}
                    </div>

                    <div class="panel-subtitle">
                        {% if metrics %}
                            {{ metrics.tipo }}
                        {% else %}
                            Aún no has ejecutado ningún modelo.
                        {% endif %}
                    </div>
                </div>

                <div class="panel-chip">Spotify 2024</div>
            </div>

            {% if metrics and metrics.ok %}
                <div class="metrics-grid">
                    {% if metrics.R2 %}<div><div class="metric-label">R²</div><div class="metric-value">{{ metrics.R2 }}</div></div>{% endif %}
                    {% if metrics.MSE %}<div><div class="metric-label">MSE</div><div class="metric-value">{{ metrics.MSE }}</div></div>{% endif %}
                    {% if metrics.MAE %}<div><div class="metric-label">MAE</div><div class="metric-value">{{ metrics.MAE }}</div></div>{% endif %}
                    {% if metrics.n_clusters %}<div><div class="metric-label">Clusters</div><div class="metric-value">{{ metrics.n_clusters }}</div></div>{% endif %}
                    {% if metrics.inercia %}<div><div class="metric-label">Inercia</div><div class="metric-value">{{ metrics.inercia }}</div></div>{% endif %}
                </div>
            {% else %}
                <div class="panel-footer">
                    Ejecuta cualquier modelo de ML para visualizar métricas aquí.
                </div>
            {% endif %}
        </aside>
    </section>



    <!-- =====================
          VISUALIZACIONES
       ===================== -->

    <!-- REGRESIÓN LINEAL -->
    {% if selected_model == "Regresión Lineal" and results and results.ok %}
    <section class="charts-section">
        <h2 class="section-title">Regresión Lineal</h2>
        <p class="section-subtitle">
           Relación entre la variable más influyente y el objetivo, junto con importancia de variables.
        </p>

        <div class="charts-grid">
            <div class="chart-card">
                <h3>Scatter + Línea de Regresión</h3>
                <img src="{{ url_for('static', filename=results.images.scatter) }}" class="chart-image">
            </div>

            <div class="chart-card">
                <h3>Importancia de Variables</h3>
                <img src="{{ url_for('static', filename=results.images.importancia) }}" class="chart-image">
            </div>
        </div>
    </section>
    {% endif %}


    <!-- ÁRBOL DE DECISIÓN -->
    {% if selected_model == "Árbol de Decisión" and metrics and metrics.ok %}
    <section class="charts-section">
        <h2 class="section-title">Árbol de Decisión</h2>
        <p class="section-subtitle">Predicción vs datos reales e importancia de variables.</p>

        <div class="charts-grid">
            <div class="chart-card">
                <h3>Reales vs Predichos</h3>
                <img src="{{ url_for('static', filename=metrics.images.real_vs_pred) }}" class="chart-image">
            </div>

            <div class="chart-card">
                <h3>Importancia de Variables</h3>
                <img src="{{ url_for('static', filename=metrics.images.importancia) }}" class="chart-image">
            </div>
        </div>
    </section>
    {% endif %}


    <!-- K-MEANS -->
    {% if selected_model == "K-means" and metrics and metrics.ok %}
    <section class="charts-section">
        <h2 class="section-title">K-means Clustering</h2>
        <p class="section-subtitle">
            Representación PCA de los clusters y tamaño de cada grupo.
        </p>

        <div class="charts-grid">
            <div class="chart-card">
                <h3>Clusters (PCA)</h3>
                <img src="{{ url_for('static', filename=metrics.images.clusters_pca) }}" class="chart-image">
            </div>

            <div class="chart-card">
                <h3>Tamaño de los Clusters</h3>
                <img src="{{ url_for('static', filename=metrics.images.tamaño_clusters) }}" class="chart-image">
            </div>
        </div>
    </section>
    {% endif %}


    <!-- ANÁLISIS DE SENTIMIENTO -->
    {% if sentimiento and sentimiento.ok %}
    <section class="charts-section">
        <h2 class="section-title">Análisis de Sentimiento – Reseñas Spotify</h2>
        <p class="section-subtitle">
            Analiza la opinión emocional de los usuarios y descubre los temas más comentados.
        </p>

        <div class="charts-grid">
            <div class="chart-card">
                <h3>Distribución del Sentimiento</h3>
                <img src="{{ url_for('static', filename=sentimiento.images.pie) }}" class="chart-image">
            </div>

            <div class="chart-card">
                <h3>Score Promedio por Sentimiento</h3>
                <img src="{{ url_for('static', filename=sentimiento.images.bar) }}" class="chart-image">
            </div>

            <div class="chart-card">
                <h3>Nube de Palabras</h3>
                <img src="{{ url_for('static', filename=sentimiento.images.wc) }}" class="chart-image">
            </div>

            <div class="chart-card">
                <h3>Palabras Más Mencionadas</h3>
                <img src="{{ url_for('static', filename=sentimiento.images.top_words) }}" class="chart-image">
            </div>
        </div>
    </section>

    {% elif sentimiento and not sentimiento.ok %}
    <section class="charts-section">
        <h3 style="color:#e74c3c;">Error al procesar análisis de sentimiento: {{ sentimiento.error }}</h3>
    </section>
    {% endif %}


    <!-- CARDS DE MODELOS -->
    <section class="cards">

        <article class="card">
            <div class="card-title">Regresión Lineal</div>
            <div class="card-tag">Predicción de streams</div>
            <p class="card-text">
                Estima el valor de <strong>Total Streams (Millions)</strong> usando variables numéricas del dataset.
            </p>
            <a href="{{ url_for('vista_regresion') }}" class="btn btn-primary">Ver modelo</a>
        </article>

        <article class="card">
            <div class="card-title">Árbol de Decisión</div>
            <div class="card-tag">Modelo interpretable</div>
            <p class="card-text">
                Identifica qué variables influyen más en el stream total.
            </p>
            <a href="{{ url_for('vista_arbol') }}" class="btn btn-primary">Ver modelo</a>
        </article>

        <article class="card">
            <div class="card-title">K-means</div>
            <div class="card-tag">Segmentación</div>
            <p class="card-text">
                Agrupa artistas o países según comportamiento de reproducción.
            </p>
            <a href="{{ url_for('vista_kmeans') }}" class="btn btn-primary">Ver clusters</a>
        </article>

        <article class="card">
            <div class="card-title">Análisis de Sentimiento</div>
            <div class="card-tag">Opiniones de los usuarios</div>
            <p class="card-text">
                Descubre si las reseñas son positivas, negativas o neutras y qué temas se repiten más.
            </p>
            <a href="{{ url_for('vista_sentimiento') }}" class="btn btn-primary">Ver análisis</a>
        </article>

        <article class="card">
            <div class="card-title">Explorar Dataset</div>
            <div class="card-tag">Spotify 2024 Global</div>
            <p class="card-text">
                Muestra una vista rápida del dataset original utilizado para el análisis.
            </p>
            <a href="{{ url_for('vista_dataset') }}" class="btn btn-primary">Ver datos</a>
        </article>

    </section>

</div>
</body>
</html>